ARM GAS  ../wanlix/wlx_core_a.asm 			page 1


   1              	
   2              	    .include "wlx_core_a.h"
   1              	
   2              	#ifndef  WLX_CORE_A_H
   3              	#define  WLX_CORE_A_H
   4              	
   5              	
   6              	/*********************************** 变量声明 *************************************/
   7              	.extern guiNextTaskSp
   8              	.extern gpuiCurTaskSpAddr
   9              	
  10              	
  11              	/*********************************** 函数声明 *************************************/
  12              	.global WLX_ContextSwitch
  13              	
  14              	
  15              	#endif
  16              	
   3              	
   4              	
   5              	    .text
   6              	    .arm
   7              	
   8              	    @函数功能: 实现任务切换功能, 将寄存器备份到当前任务堆栈中, 从将要运行任务堆栈中
   9              	    @          取出寄存器保存值并跳转到将要运行任务执行.
  10              	    @入口参数: none.
  11              	    @返 回 值: none.
  12              	    .func WLX_ContextSwitch
  13              	WLX_ContextSwitch:
  14              	
  15              	    @保存当前任务的堆栈信息
  16 0000 FF7F0DE9 	    STMDB  R13, {R0-R14}
  17 0004 3CD04DE2 	    SUB    R13, R13, #0x3C
  18 0008 00000FE1 	    MRS    R0, CPSR
  19 000c 04002DE5 	    STMDB  R13!, {R0}
  20              	
  21              	    @保存当前任务的指针值
  22 0010 24009FE5 	    LDR    R0, =gpuiCurTaskSpAddr
  23 0014 001090E5 	    LDR    R1, [R0]
  24 0018 000051E3 	    CMP    R1, #0
  25 001c 0000000A 	    BEQ    GETNEXTTASKSP
  26 0020 00D081E5 	    STR    R13, [R1]
  27              	
  28              	GETNEXTTASKSP:
  29              	    @获取将要运行任务的堆栈信息并运行新任务
  30 0024 14009FE5 	    LDR    R0, =guiNextTaskSp
  31 0028 00D090E5 	    LDR    R13, [R0]
  32 002c 04009DE4 	    LDMIA  R13!, {R0}
  33 0030 00F029E1 	    MSR    CPSR, R0
  34 0034 FF7F9DE8 	    LDMIA  R13, {R0-R14}
  35 0038 1EFF2FE1 	    BX     R14
  36              	
  37              	    .endfunc
  38              	
  39              	
  40 003c 00000000 	    .end
  40      00000000 
ARM GAS  ../wanlix/wlx_core_a.asm 			page 2


ARM GAS  ../wanlix/wlx_core_a.asm 			page 3


DEFINED SYMBOLS
../wanlix/wlx_core_a.asm:13     .text:00000000 WLX_ContextSwitch
../wanlix/wlx_core_a.asm:16     .text:00000000 $a
../wanlix/wlx_core_a.asm:28     .text:00000024 GETNEXTTASKSP
../wanlix/wlx_core_a.asm:40     .text:0000003c $d
                   .debug_aranges:0000000c $d

UNDEFINED SYMBOLS
gpuiCurTaskSpAddr
guiNextTaskSp
